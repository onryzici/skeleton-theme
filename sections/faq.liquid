{% comment %}
  FAQ Section
  Accordion-style frequently asked questions
{% endcomment %}

<style>
  /* Full-width background */
  #shopify-section-{{ section.id }} section {
    width: 100vw;
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
  }

  /* FAQ Accordion Animation */
  #shopify-section-{{ section.id }} .faq-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease;
    opacity: 0;
  }

  #shopify-section-{{ section.id }} details[open] .faq-content {
    opacity: 1;
  }

  #shopify-section-{{ section.id }} details[open] .chevron {
    transform: rotate(180deg);
  }

  #shopify-section-{{ section.id }} .chevron {
    transition: transform 0.3s ease;
  }

  #shopify-section-{{ section.id }} details {
    display: block !important;
  }

  #shopify-section-{{ section.id }} details summary {
    display: flex !important;
  }

  #shopify-section-{{ section.id }} details .faq-content {
    display: block !important;
    width: 100% !important;
  }
</style>

<section class="bg-gray-50 py-12 lg:py-20 px-4 sm:px-6 lg:px-8">
  <div class="max-w-7xl mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-16">

      {% comment %} Left Column - Heading & Button {% endcomment %}
      <div class="lg:col-span-4">
        <h2 class="text-4xl lg:text-5xl font-bold font-sans text-gray-900 mb-6 lg:mb-8">
          {{ section.settings.heading | default: 'Frequently Asked Questions' }}
        </h2>

        {% if section.settings.button_text != blank %}
          <a
            href="{{ section.settings.button_link | default: '#' }}"
            class="inline-flex items-center px-6 py-3 border-2 border-gray-900 text-gray-900 font-semibold text-base font-sans rounded-full hover:bg-gray-900 hover:text-white transition-all duration-300"
          >
            {{ section.settings.button_text }}
          </a>
        {% endif %}
      </div>

      {% comment %} Right Column - FAQ Items {% endcomment %}
      <div class="lg:col-span-8 space-y-4">
        {% for block in section.blocks %}
          {% if block.type == 'faq_item' %}
            <div class="bg-white rounded-2xl shadow-sm" {{ block.shopify_attributes }}>
              <details class="group" {% if block.settings.open_by_default %}open{% endif %} data-faq-item>
                <summary class="flex justify-between items-start cursor-pointer list-none px-6 py-6 w-full">
                  <span class="text-lg lg:text-xl font-semibold font-sans text-gray-900 pr-4 flex-1">
                    {{ block.settings.question }}
                  </span>
                  <svg class="w-6 h-6 text-gray-600 chevron flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                  </svg>
                </summary>
                <div class="faq-content px-6 pb-6 text-base text-gray-600 font-sans leading-relaxed">
                  {{ block.settings.answer }}
                </div>
              </details>
            </div>
          {% endif %}
        {% endfor %}
      </div>

    </div>
  </div>
</section>

<script>
  // Smooth animation for FAQ accordions
  (function() {
    const faqItems = document.querySelectorAll('#shopify-section-{{ section.id }} details[data-faq-item]');

    faqItems.forEach(details => {
      const summary = details.querySelector('summary');
      const content = details.querySelector('.faq-content');

      if (!summary || !content) return;

      // Set initial styles
      content.style.overflow = 'hidden';

      if (details.open) {
        content.style.maxHeight = content.scrollHeight + 'px';
        content.style.opacity = '1';
      } else {
        content.style.maxHeight = '0';
        content.style.opacity = '0';
      }

      summary.addEventListener('click', function(e) {
        e.preventDefault();

        if (details.open) {
          // Closing
          const startHeight = content.scrollHeight;
          content.style.maxHeight = startHeight + 'px';

          requestAnimationFrame(() => {
            content.style.maxHeight = '0';
            content.style.opacity = '0';
          });

          setTimeout(() => {
            details.open = false;
          }, 500);
        } else {
          // Opening
          details.open = true;
          const endHeight = content.scrollHeight;
          content.style.maxHeight = '0';
          content.style.opacity = '0';

          requestAnimationFrame(() => {
            content.style.maxHeight = endHeight + 'px';
            content.style.opacity = '1';
          });

          setTimeout(() => {
            content.style.maxHeight = '3000px';
          }, 500);
        }
      });
    });
  })();
</script>

{% schema %}
{
  "name": "FAQ",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Ask another question"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    }
  ],
  "blocks": [
    {
      "type": "faq_item",
      "name": "FAQ Item",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Question",
          "default": "What is your question?"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Answer",
          "default": "<p>Your answer goes here. You can use rich text formatting.</p>"
        },
        {
          "type": "checkbox",
          "id": "open_by_default",
          "label": "Open by default",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "FAQ",
      "blocks": [
        {
          "type": "faq_item",
          "settings": {
            "question": "How to cancel the subscription?",
            "answer": "<p>XNote seamlessly bridges the gap between traditional writing and digital innovation. Enjoy the familiar feel of pen on paper while instantly transforming your ideas into searchable, editable digital content. XNote seamlessly bridges the gap between traditional writing and digital innovation. Enjoy the familiar feel of pen on...</p>",
            "open_by_default": true
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "Can I transfer my AI premium membership to another account?",
            "answer": "<p>Yes, you can transfer your membership. Please contact our support team for assistance with the transfer process.</p>",
            "open_by_default": false
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "Does XNote AI save my notes? How is my personal data and information protected?",
            "answer": "<p>Your data security is our top priority. All notes are encrypted and stored securely. We follow industry-standard security practices to protect your information.</p>",
            "open_by_default": false
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "Under what circumstances does XNote AI or its affiliates access a user's personal data?",
            "answer": "<p>We only access user data when necessary for service improvement, technical support, or as required by law. Your privacy is always maintained.</p>",
            "open_by_default": false
          }
        }
      ]
    }
  ]
}
{% endschema %}
