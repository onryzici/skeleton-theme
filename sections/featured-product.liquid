{% comment %}
  Featured Product Section
  Minimal design with product details and collapsible tabs
{% endcomment %}

{%- liquid
  assign product = section.settings.product
  assign product_form_id = 'product-form-' | append: section.id
-%}

<style>
  /* Animations */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  #shopify-section-{{ section.id }} .product-media {
    animation: fadeInUp 0.6s ease forwards;
  }

  #shopify-section-{{ section.id }} .product-info {
    animation: fadeInUp 0.6s ease forwards 0.2s;
    opacity: 0;
  }

  /* Collapsible Tab Styles - Ultra Smooth Grid-Based */
  #shopify-section-{{ section.id }} .collapsible-content {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
  }

  #shopify-section-{{ section.id }} .collapsible-content.active {
    grid-template-rows: 1fr;
    opacity: 1;
  }

  #shopify-section-{{ section.id }} .collapsible-content > div {
    overflow: hidden;
  }

  #shopify-section-{{ section.id }} .collapsible-trigger svg {
    transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: transform;
  }

  #shopify-section-{{ section.id }} .collapsible-trigger.active svg {
    transform: rotate(45deg);
  }

  /* Smooth hover effect */
  #shopify-section-{{ section.id }} .collapsible-trigger {
    transition: opacity 0.25s ease;
  }

  #shopify-section-{{ section.id }} .collapsible-trigger:hover {
    opacity: 0.7;
  }

  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    #shopify-section-{{ section.id }} .collapsible-content,
    #shopify-section-{{ section.id }} .collapsible-trigger svg {
      transition-duration: 0.01ms !important;
    }
  }

  /* Image slider dots */
  #shopify-section-{{ section.id }} .slider-dots {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin-top: 24px;
  }

  #shopify-section-{{ section.id }} .slider-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #d1d5db;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  #shopify-section-{{ section.id }} .slider-dot.active {
    background: #1f2937;
  }

  /* Product media - fully rounded on mobile, left rounded on desktop */
  #shopify-section-{{ section.id }} .product-media-wrapper {
    border-radius: 3rem;
    background: #f3f4f6;
  }

  @media (min-width: 1024px) {
    #shopify-section-{{ section.id }} .product-media-wrapper {
      border-radius: 3rem 0 0 3rem;
    }
  }
</style>

<div class="featured-product" style="padding-top: {{ section.settings.padding_top_mobile }}px; padding-bottom: {{ section.settings.padding_bottom_mobile }}px;">
  <style>
    @media (min-width: 1024px) {
      #shopify-section-{{ section.id }} .featured-product {
        padding-top: {{ section.settings.padding_top_desktop }}px !important;
        padding-bottom: {{ section.settings.padding_bottom_desktop }}px !important;
      }
    }
  </style>
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">

    {% if product != blank %}
      <div class="grid grid-cols-1 lg:grid-cols-[1.2fr_1fr] gap-0 lg:gap-12 items-center">

        {% comment %} Left Side - Product Media {% endcomment %}
        <div class="product-media mb-8 lg:mb-0">
          <div class="product-media-wrapper overflow-hidden">
            {% if product.featured_media %}
              <div class="aspect-square flex items-center justify-center p-12 lg:p-16">
                <img
                  src="{{ product.featured_media | image_url: width: 1000 }}"
                  alt="{{ product.featured_media.alt | escape }}"
                  width="{{ product.featured_media.width }}"
                  height="{{ product.featured_media.height }}"
                  loading="lazy"
                  class="w-full h-full object-contain"
                >
              </div>
            {% else %}
              <div class="aspect-square flex items-center justify-center bg-gray-200">
                {{ 'product-1' | placeholder_svg_tag: 'w-full h-full object-cover' }}
              </div>
            {% endif %}
          </div>

          {% comment %} Image Slider Dots {% endcomment %}
          {% if product.media.size > 1 %}
            <div class="slider-dots">
              {% for media in product.media limit: 5 %}
                <button
                  type="button"
                  class="slider-dot {% if forloop.first %}active{% endif %}"
                  aria-label="View image {{ forloop.index }}"
                >
                </button>
              {% endfor %}
            </div>
          {% endif %}
        </div>

        {% comment %} Right Side - Product Info {% endcomment %}
        <div class="product-info max-w-xl lg:max-w-none">

          {% for block in section.blocks %}
            {% case block.type %}

              {% when 'title' %}
                <h1 class="text-2xl sm:text-3xl lg:text-4xl font-medium font-sans text-gray-900 mb-4 lg:mb-6" {{ block.shopify_attributes }}>
                  {{ product.title | escape }}
                </h1>

              {% when 'price' %}
                <div class="mb-4 lg:mb-6" {{ block.shopify_attributes }}>
                  <div class="flex items-baseline gap-3">
                    <span class="text-2xl lg:text-3xl font-bold text-gray-900">
                      {{ product.price | money }}
                    </span>
                    {% if product.compare_at_price > product.price %}
                      <span class="text-lg lg:text-xl text-gray-400 line-through">
                        {{ product.compare_at_price | money }}
                      </span>
                    {% endif %}
                  </div>
                </div>

              {% when 'rating' %}
                {% if block.settings.show_rating %}
                  <div class="flex items-center gap-2 mb-6 lg:mb-8" {{ block.shopify_attributes }}>
                    <div class="flex text-yellow-400">
                      {% for i in (1..5) %}
                        <svg class="w-4 h-4 lg:w-5 lg:h-5 fill-current" viewBox="0 0 20 20">
                          <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                        </svg>
                      {% endfor %}
                    </div>
                    <span class="text-sm text-gray-600">{{ block.settings.review_count }} reviews</span>
                  </div>
                {% endif %}

            {% endcase %}
          {% endfor %}

          {% comment %} Collapsible Tabs Container {% endcomment %}
          <div class="border border-gray-200 rounded-2xl overflow-hidden mb-6">
            {% for block in section.blocks %}
              {% if block.type == 'collapsible_tab' %}
                <div class="border-b border-gray-200 last:border-b-0" {{ block.shopify_attributes }}>
                  <button
                    type="button"
                    class="collapsible-trigger w-full px-5 py-4 flex items-center justify-between text-left hover:bg-gray-50 transition-colors"
                    data-collapsible-trigger
                  >
                    <div class="flex items-center gap-3">
                      {% if block.settings.icon_type == 'star' %}
                        <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                        </svg>
                      {% elsif block.settings.icon_type == 'box' %}
                        <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                        </svg>
                      {% elsif block.settings.icon_type == 'document' %}
                        <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                      {% endif %}
                      <span class="font-medium text-gray-900 text-sm lg:text-base">{{ block.settings.heading }}</span>
                    </div>
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                  </button>
                  <div class="collapsible-content">
                    <div>
                      <div class="px-5 pt-2 pb-4 text-sm text-gray-600 leading-relaxed">
                        {{ block.settings.content }}
                      </div>
                    </div>
                  </div>
                </div>
              {% endif %}
            {% endfor %}
          </div>

          {% comment %} Buy Buttons Section {% endcomment %}
          {% for block in section.blocks %}
            {% if block.type == 'buy_buttons' %}
              <div class="mb-6" {{ block.shopify_attributes }}>
                <form id="{{ product_form_id }}" action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data">
                  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">

                  <div class="flex flex-col lg:flex-row gap-3 mb-3">
                    {% comment %} Add to Cart Button {% endcomment %}
                    <button
                      type="submit"
                      name="add"
                      class="w-full lg:flex-1 px-6 py-4 lg:py-3.5 bg-black text-white font-medium text-base rounded-full hover:bg-gray-800 transition-colors duration-300"
                      {% unless product.available %}disabled{% endunless %}
                    >
                      {% if product.available %}
                        {{ block.settings.add_to_cart_text | default: 'Add to Cart' }}
                      {% else %}
                        Sold out
                      {% endif %}
                    </button>

                    {% comment %} Shop Pay Button {% endcomment %}
                    {% if block.settings.show_dynamic_checkout %}
                      <button
                        type="button"
                        class="w-full lg:flex-1 px-6 py-4 lg:py-3.5 bg-white border-2 border-gray-900 text-gray-900 font-medium text-base rounded-full hover:bg-gray-50 transition-colors duration-300 flex items-center justify-center gap-2"
                      >
                        Buy with
                        <span class="font-bold">Shop</span>
                      </button>
                    {% endif %}
                  </div>

                  {% comment %} More Payment Options {% endcomment %}
                  {% if block.settings.show_payment_options %}
                    <div class="text-center">
                      <a href="#" class="text-xs lg:text-sm text-gray-600 hover:text-gray-900 underline">
                        More payment options
                      </a>
                    </div>
                  {% endif %}
                </form>
              </div>
            {% endif %}
          {% endfor %}

          {% comment %} View Full Details Button {% endcomment %}
          {% for block in section.blocks %}
            {% if block.type == 'share' %}
              <div {{ block.shopify_attributes }}>
                <a
                  href="{{ product.url }}"
                  class="flex items-center justify-between w-full px-5 py-4 border border-gray-200 rounded-2xl text-base font-medium text-gray-900 hover:bg-gray-50 transition-colors group overflow-hidden"
                >
                  <span>{{ block.settings.link_text | default: 'View full details' }}</span>
                  <svg class="w-5 h-5 flex-shrink-0 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                  </svg>
                </a>
              </div>
            {% endif %}
          {% endfor %}

        </div>

      </div>

    {% else %}
      {% comment %} Placeholder when no product is selected {% endcomment %}
      <div class="text-center py-16">
        <p class="text-gray-500">Select a product to display in the theme editor</p>
      </div>
    {% endif %}

  </div>
</div>

{% schema %}
{
  "name": "Featured Product",
  "tag": "section",
  "class": "section-featured-product",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Product"
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding (mobile)",
      "default": 32
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding (mobile)",
      "default": 32
    },
    {
      "type": "range",
      "id": "padding_top_desktop",
      "min": 0,
      "max": 152,
      "step": 4,
      "unit": "px",
      "label": "Top padding (desktop)",
      "default": 48
    },
    {
      "type": "range",
      "id": "padding_bottom_desktop",
      "min": 0,
      "max": 152,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding (desktop)",
      "default": 48
    }
  ],
  "blocks": [
    {
      "type": "title",
      "name": "Product Title",
      "limit": 1
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1
    },
    {
      "type": "rating",
      "name": "Product Rating",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_rating",
          "label": "Show rating",
          "default": true
        },
        {
          "type": "number",
          "id": "review_count",
          "label": "Number of reviews",
          "default": 134
        }
      ]
    },
    {
      "type": "collapsible_tab",
      "name": "Collapsible Tab",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Collapsible tab"
        },
        {
          "type": "select",
          "id": "icon_type",
          "label": "Icon",
          "options": [
            {
              "value": "star",
              "label": "Star (Features)"
            },
            {
              "value": "box",
              "label": "Box (Contents)"
            },
            {
              "value": "document",
              "label": "Document (Specs)"
            }
          ],
          "default": "star"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Add details about your product here.</p>"
        }
      ]
    },
    {
      "type": "buy_buttons",
      "name": "Buy Buttons",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "add_to_cart_text",
          "label": "Add to cart button text",
          "default": "Add to Cart"
        },
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "label": "Show Buy with Shop button",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_payment_options",
          "label": "Show more payment options link",
          "default": true
        }
      ]
    },
    {
      "type": "share",
      "name": "Product Link",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "link_text",
          "label": "Link text",
          "default": "View full details"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured Product",
      "blocks": [
        {
          "type": "title"
        },
        {
          "type": "price"
        },
        {
          "type": "rating"
        },
        {
          "type": "collapsible_tab",
          "settings": {
            "heading": "Features & Benefits",
            "icon_type": "star"
          }
        },
        {
          "type": "collapsible_tab",
          "settings": {
            "heading": "Box Contents",
            "icon_type": "box"
          }
        },
        {
          "type": "collapsible_tab",
          "settings": {
            "heading": "Technical Specs",
            "icon_type": "document"
          }
        },
        {
          "type": "buy_buttons"
        },
        {
          "type": "share"
        }
      ]
    }
  ]
}
{% endschema %}

<script>
  // Ultra smooth grid-based collapsible animation - no height calculations needed!
  (function() {
    const triggers = document.querySelectorAll('#shopify-section-{{ section.id }} [data-collapsible-trigger]');

    triggers.forEach(trigger => {
      const content = trigger.nextElementSibling;
      if (!content) return;

      // Simple toggle - CSS grid handles the smooth animation
      trigger.addEventListener('click', function() {
        this.classList.toggle('active');
        content.classList.toggle('active');
      });

      // Keyboard accessibility
      trigger.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          trigger.click();
        }
      });
    });
  })();
</script>
