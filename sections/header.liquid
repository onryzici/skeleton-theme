{% comment %}
  Header Section
  Main navigation with logo, menu, and utility icons
{% endcomment %}

<div class="full-width header-wrapper sticky top-0 z-50 transition-all duration-300">
  <header class="header container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center h-16 lg:h-[72px]">

      {% comment %} Logo - Left {% endcomment %}
      <div class="flex-shrink-0 mr-8 lg:mr-12">
        <a href="{{ routes.root_url }}" class="flex items-center">
          {% if section.settings.logo != blank %}
            <img
              src="{{ section.settings.logo | image_url: width: 200 }}"
              alt="{{ shop.name }}"
              class="h-8 lg:h-10 w-auto"
              width="{{ section.settings.logo.width }}"
              height="{{ section.settings.logo.height }}"
              loading="lazy"
            >
          {% else %}
            <span class="text-xl lg:text-2xl font-bold font-sans">{{ shop.name }}</span>
          {% endif %}
        </a>
      </div>

      {% comment %} Navigation Menu - Center {% endcomment %}
      <nav class="hidden lg:flex items-center space-x-8 xl:space-x-10 flex-1 justify-center">
        {% for link in section.settings.menu.links %}
          <a
            href="{{ link.url }}"
            class="nav-link relative text-base font-medium font-sans text-gray-900 hover:text-gray-600 transition-colors whitespace-nowrap py-2"
          >
            {{ link.title }}
          </a>
        {% endfor %}
      </nav>

      {% comment %} Icons - Right {% endcomment %}
      <div class="flex items-center space-x-3 lg:space-x-4 ml-auto">

        {% comment %} Search Icon {% endcomment %}
        <button
          type="button"
          onclick="openSearchDrawer()"
          class="text-gray-900 hover:text-gray-600 transition-colors p-2"
          aria-label="Search"
        >
          <svg class="w-5 h-5 lg:w-[22px] lg:h-[22px]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
        </button>

        {% comment %} Account Icon {% endcomment %}
        {% if shop.customer_accounts_enabled %}
          <a
            href="{{ routes.account_url }}"
            class="text-gray-900 hover:text-gray-600 transition-colors p-2"
            aria-label="Account"
          >
            <svg class="w-5 h-5 lg:w-[22px] lg:h-[22px]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
          </a>
        {% endif %}

        {% comment %} Cart Icon {% endcomment %}
        <button
          type="button"
          onclick="openCartDrawer()"
          class="text-gray-900 hover:text-gray-600 transition-colors relative p-2"
          aria-label="Cart"
        >
          <svg class="w-5 h-5 lg:w-[22px] lg:h-[22px]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
          </svg>
          {% if cart.item_count > 0 %}
            <span class="header-cart-count absolute -top-2 -right-2 bg-black text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">
              {{ cart.item_count }}
            </span>
          {% endif %}
        </button>

        {% comment %} Mobile Menu Toggle {% endcomment %}
        <button
          type="button"
          class="lg:hidden text-gray-900 hover:text-gray-600"
          aria-label="Menu"
          id="mobile-menu-toggle"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>

    </div>

    {% comment %} Mobile Menu {% endcomment %}
    <div class="lg:hidden hidden border-t border-gray-200" id="mobile-menu">
      <div class="py-3 space-y-1">
        {% for link in section.settings.menu.links %}
          <a
            href="{{ link.url }}"
            class="block px-3 py-2 text-base font-medium font-sans text-gray-900 hover:text-gray-600 hover:bg-gray-50 rounded-md transition-colors"
          >
            {{ link.title }}
          </a>
        {% endfor %}
      </div>
    </div>
  </header>
</div>

<script>
  // Mobile menu toggle
  document.getElementById('mobile-menu-toggle')?.addEventListener('click', function() {
    const mobileMenu = document.getElementById('mobile-menu');
    mobileMenu.classList.toggle('hidden');
  });

  // Set active nav link based on current URL
  document.addEventListener('DOMContentLoaded', function() {
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.nav-link');

    navLinks.forEach(link => {
      const linkPath = new URL(link.href).pathname;

      // Check if current page matches link
      if (currentPath === linkPath ||
          (linkPath !== '/' && currentPath.startsWith(linkPath))) {
        link.classList.add('active');
      }
    });
  });

  // Sticky header with hide on scroll down, show on scroll up
  let lastScroll = 0;
  const headerWrapper = document.querySelector('.header-wrapper');

  window.addEventListener('scroll', function() {
    const currentScroll = window.pageYOffset;

    // Add scrolled class for blur effect
    if (currentScroll > 10) {
      headerWrapper.classList.add('scrolled');
    } else {
      headerWrapper.classList.remove('scrolled');
    }

    // Hide on scroll down, show on scroll up
    if (currentScroll > lastScroll && currentScroll > 100) {
      // Scrolling down & past 100px
      headerWrapper.classList.add('header-hidden');
    } else if (currentScroll < lastScroll) {
      // Scrolling up
      headerWrapper.classList.remove('header-hidden');
    }

    lastScroll = currentScroll;
  });
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image",
      "info": "Recommended size: 200x50px"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 10,
      "unit": "px",
      "label": "Logo width",
      "default": 150
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu",
      "info": "Select a menu to display in the header"
    },
    {
      "type": "header",
      "content": "Search"
    },
    {
      "type": "checkbox",
      "id": "enable_search",
      "label": "Enable search",
      "default": true
    },
    {
      "type": "header",
      "content": "Sticky Header"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_header",
      "label": "Enable sticky header",
      "default": true,
      "info": "Header will stay at the top when scrolling"
    }
  ]
}
{% endschema %}

<style>
  /* Header base styles */
  .header-wrapper {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    border-bottom: 1px solid transparent;
    transform: translateY(0);
  }

  .header-wrapper.scrolled {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.06);
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  }

  /* Hide header on scroll down */
  .header-wrapper.header-hidden {
    transform: translateY(-100%);
  }

  /* Navigation link active state with underline */
  .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: #000;
    transform: scaleX(0);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin: center;
  }

  .nav-link.active::after,
  .nav-link:hover::after {
    transform: scaleX(1);
  }

  /* Logo sizing */
  {% if section.settings.logo != blank %}
    .header .flex-shrink-0 img {
      width: {{ section.settings.logo_width }}px;
      height: auto;
    }
  {% endif %}

  /* Disable sticky if setting is off */
  {% unless section.settings.enable_sticky_header %}
    .header-wrapper {
      position: relative !important;
    }
  {% endunless %}
</style>
